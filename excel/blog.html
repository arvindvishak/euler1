Even though I use <a href="http://office.microsoft.com/en-us/excel/">Excel</a> heavily, I've never used its formulas much beyond the basic - I'm simply more comfortable in a more formal programming environment. I knew there were basic operations, but this <a title="Euler1" href="http://projecteuler.net/problem=1">Euler</a> exercise brings up an interesting question - just how <a href="http://en.wikipedia.org/wiki/Turing_completeness">Turing-complete</a> are Excel formulas?

Apparently a lot more than I expected. With the addition of <a href="http://www.cpearson.com/excel/ArrayFormulas.aspx">Array Formulas</a>, Excel functions can both accept arrays as arguments and return arrays. Thus, Excel supports the canonical Map, Filter, and Fold - tres bien! Witness:

In this example of Map, <em>ROW()</em> returns the array [1:10] to the function <em>n*2</em>, and the whole returns the array [2,4, ... 18,20]:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span>ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">10</span>) <span style="color:#555555;">*</span> <span style="color:#ff6600;">2</span></pre>
</div>
In this example of Filter, <em>ROW()</em> returns the array [1:10] to the function <em>IF()</em>, and the whole returns the array [2,4,6,8,10]:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span><span style="color:#006699;font-weight:bold;">IF</span>(<span style="color:#000000;font-weight:bold;">MOD</span>(ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">10</span>),<span style="color:#ff6600;">2</span>)<span style="color:#555555;">=</span><span style="color:#ff6600;">0</span>,ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">10</span>),<span style="color:#ff6600;">""</span>)</pre>
</div>
And in this example of Fold, we'll use the built-in <em>SUM()</em>, which returns 55 when we pass it the array [1:10]:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span>SUM(ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">10</span>))</pre>
</div>
Array functions must be entered in using <em>Shift-Ctrl-Enter</em>, which is probably why I never stumbled upon them over all these years.

So, combining these gives us the following Euler1 using Excel's built-in functions. Or does it? It doesn't seem to work - it returns the incorrect result 499,500:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span>SUM( <span style="color:#006699;font-weight:bold;">IF</span>(<span style="color:#000000;font-weight:bold;">OR</span>(<span style="color:#000000;font-weight:bold;">MOD</span>(ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>),<span style="color:#ff6600;">3</span>)<span style="color:#555555;">=</span><span style="color:#ff6600;">0</span>, <span style="color:#000000;font-weight:bold;">MOD</span>(ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>),<span style="color:#ff6600;">5</span>)<span style="color:#555555;">=</span><span style="color:#ff6600;">0</span>), ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>), <span style="color:#006699;font-weight:bold;">FALSE</span>) )</pre>
</div>
What's going on here? The following works as expected, returning 166,833:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span>SUM( <span style="color:#006699;font-weight:bold;">IF</span>(<span style="color:#000000;font-weight:bold;">MOD</span>(ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>),<span style="color:#ff6600;">3</span>)<span style="color:#555555;">=</span><span style="color:#ff6600;">0</span>, ROW(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>), <span style="color:#006699;font-weight:bold;">FALSE</span>) )</pre>
</div>
I haven't been able to figure this out. It seems that <em>OR(MOD3, MOD5)</em> returns true for all elements in the set. I'm ready to chalk this up to a bug in Excel. Damnit, and I was all ready to go wield some Excel-fu.

Okay, but can we actually get a solution using Excel's formulas? Sure, if we use a different algorithm that doesn't require looping; here is one that uses <a title="Gauss" href="http://en.wikipedia.org/wiki/Carl_Friedrich_Gauss">Carl Freidrich Gauss's</a> <a title="Gauss Summation" href="http://mathforum.org/library/drmath/view/57919.html">summation technique</a>. I won't bother breaking it down - it's complicated. Paste this formula in cell A1, then enter in a number in B1 (in this case 999) and get your solution:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span> (<span style="color:#ff6600;">3</span><span style="color:#555555;">*</span>((<span style="color:#336600;">FLOOR</span>(<span style="color:#336600;">A2</span><span style="color:#555555;">/</span><span style="color:#ff6600;">3</span>,<span style="color:#ff6600;">1</span>)<span style="color:#555555;">^</span><span style="color:#ff6600;">2</span><span style="color:#555555;">+</span><span style="color:#336600;">FLOOR</span>(<span style="color:#336600;">A2</span><span style="color:#555555;">/</span><span style="color:#ff6600;">3</span>,<span style="color:#ff6600;">1</span>))<span style="color:#555555;">/</span><span style="color:#ff6600;">2</span>)) <span style="color:#555555;">+</span> (<span style="color:#ff6600;">5</span><span style="color:#555555;">*</span>((<span style="color:#336600;">FLOOR</span>(<span style="color:#336600;">A2</span><span style="color:#555555;">/</span><span style="color:#ff6600;">5</span>,<span style="color:#ff6600;">1</span>)<span style="color:#555555;">^</span><span style="color:#ff6600;">2</span><span style="color:#555555;">+</span><span style="color:#336600;">FLOOR</span>(<span style="color:#336600;">A2</span><span style="color:#555555;">/</span><span style="color:#ff6600;">5</span>,<span style="color:#ff6600;">1</span>))<span style="color:#555555;">/</span><span style="color:#ff6600;">2</span>)) <span style="color:#555555;">-</span> (<span style="color:#ff6600;">15</span><span style="color:#555555;">*</span>((<span style="color:#336600;">FLOOR</span>(<span style="color:#336600;">A2</span><span style="color:#555555;">/</span><span style="color:#ff6600;">15</span>,<span style="color:#ff6600;">1</span>)<span style="color:#555555;">^</span><span style="color:#ff6600;">2</span><span style="color:#555555;">+</span><span style="color:#336600;">FLOOR</span>(<span style="color:#336600;">A2</span><span style="color:#555555;">/</span><span style="color:#ff6600;">15</span>,<span style="color:#ff6600;">1</span>))<span style="color:#555555;">/</span><span style="color:#ff6600;">2</span>))</pre>
</div>
Update: a kind reader got this to work for me! Apparently the above code doesn't work because <em>OR</em> returns <em>TRUE</em> if any element of the array is true. The following modification works because attempting to add together two booleans forces Excel to cast <em>TRUE</em> to 1 and <em>FALSE</em> to 0:
<div style="background:white;overflow:auto;width:auto;color:black;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
<pre style="line-height:125%;margin:0;"><span style="color:#555555;">=</span><span style="color:#336600;">SUM</span>( <span style="color:#336600;">IF</span>((<span style="color:#336600;">MOD</span>(<span style="color:#336600;">ROW</span>(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>),<span style="color:#ff6600;">3</span>)<span style="color:#555555;">=</span><span style="color:#ff6600;">0</span>)<span style="color:#555555;">+</span>(<span style="color:#336600;">MOD</span>(<span style="color:#336600;">ROW</span>(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>),<span style="color:#ff6600;">5</span>)<span style="color:#555555;">=</span><span style="color:#ff6600;">0</span>), <span style="color:#336600;">ROW</span>(<span style="color:#ff6600;">1</span>:<span style="color:#ff6600;">999</span>), <span style="color:#336600;">FALSE</span>) )</pre>
</div>